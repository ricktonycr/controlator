<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
	<title>Presentaci√≥n</title>
  <style type="text/css">

div, html, body{
  margin: 0px;
  padding: 0px;
  border: none;
}

html, body{
  width: 100%;
  height: 100%;
}


#content-all{
  width: 100%;
  height: calc(100% - 30px);
  background-color: #333;
  color: #fff;
  display: inline-block;
  text-align: center;
}

canvas{
  background-color: #ffffff;
}

  </style>
</head>
<body>
  <div id="content-all">

    <canvas id="myCanvas" width="700px" height="500px" >
      Your browser don't support canvas tag
    </canvas>

  </div>
  <div id="buttons">
    <button id="connect">Conectar</button>
    <button id="expand">Expandir</button>
  </div>
  <script src="js/webrtcConnection.js"></script>
  <script src="../../js/jquery-1.11.3.js"></script>
  <script type="text/javascript">
    (function(){

      var cont = 0;
      var content = document.getElementById("content-all");
      
      var canvas = document.getElementById('myCanvas');
      var context = canvas.getContext('2d');
      var centerX = canvas.width / 2;
      var radius = 15;
      var centerY = canvas.height-radius;
      var start = false;

      context.beginPath();
      context.arc(centerX, centerY, radius, 0, 2 * Math.PI, false);
      context.fillStyle = '#64B5F6';
      context.fill();

      vx = 0;
      vy = 0;
      g = 0.0;
      obstacleSpeed = 1;

      var obs = [{tall:300,y:0},{tall:500,y:250}];

      function drawObstacles(obs){
        obstacleSpeed += 0.0005;
        obs.y += obstacleSpeed;
        if(obs.y > canvas.height){
          obs.y = 0;
          obs.tall = Math.random()*(canvas.width-100)+50;
        }
        context.rect(0,obs.y,obs.tall-50,40);
        context.fillStyle = 'black';
        context.fill();
        context.rect(obs.tall+50,obs.y,canvas.width-obs.tall+50,40);
        context.fill();
      }

      function moving(){

        context.clearRect(0,0,canvas.width,canvas.height);

        if(start)
        for(var i=0;i<obs.length;i++)
          drawObstacles(obs[i]);

        if(centerY >= canvas.height - radius && vy > 0){
          centerY = canvas.height - radius; 
        }else{
          centerY += vy;
          if(centerY < 0)
            centerY = 0;
        }

        if(centerX <= canvas.width && centerX >= 0){
          centerX += vx;
        }else{
          if(centerX >= canvas.width)
            centerX = canvas.width;
          if(centerX < 0)
            centerX = 0;
        }

        context.beginPath();
        context.arc(centerX, centerY, radius, 0, 2 * Math.PI, false);
        context.fillStyle = '#64B5F6';
        context.fill();

        requestAnimationFrame(moving);
      }

      requestAnimationFrame(moving);


      function message(mess){
        start = true;
        var input = JSON.parse(mess);

        switch(input.id){
          case 1:

            if(Math.abs(input.value)<0.2){
              vx = 0;
            }else{
              vx = Math.pow(input.value,2)*(input.value/Math.abs(input.value));
            }

          break;
          case 2:

            if(Math.abs(input.value)<0.2){
              vy = 0;
            }else{
              vy = input.value;
            }

          break;
          case 3:
            context.clearRect(0,0,canvas.width,canvas.height);
          break;
          case 4:
          break;
        }
      }

      RTC.init("server","control","ws://10.42.0.1:1232",'websocket',message);
      
      var connectButton = document.getElementById("connect");
      var expandButton = document.getElementById("expand");
      connectButton.addEventListener("click",function(){
        RTC.openConnection();
      });
      expandButton.addEventListener("click",function(){
        img.webkitRequestFullScreen();
      });

    })();
  </script>
</body>
</html>